<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet">
  <!-- <script src="https://unpkg.com/html5-qrcode@2.3.10/html5-qrcode.min.js" ></script> -->
  <script src="https://unpkg.com/html5-qrcode"></script>

  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <link rel="stylesheet" href="./index.css">


  <style>
    body { font-family: 'Prompt', sans-serif; }
    .section { display: none; }
    .section.active { display: block; }
    

   
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  
  <script>
    let qrScanner;
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á client
    const supabase = window.supabase.createClient(
      "https://ukdachhtnvhoxaospqls.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVrZGFjaGh0bnZob3hhb3NwcWxzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUzNDU1NDUsImV4cCI6MjA2MDkyMTU0NX0.tHns58dgK_OgGS4YWBt7SCA3Er7Pmw9JlECEH7pt5j8"
    );

    async function loadEmployeeInfo() {
      await supabase.auth.refreshSession();
      const { data: { user }, error: userError } = await supabase.auth.getUser();
      console.log("‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏à‡∏≤‡∏Å Supabase Auth:", user.email);

      const { data, error } = await supabase
        .from('employees')
        .select('*')
        .eq('email', user.email) ; // filter ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ email ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      console.log(data);
      console.log("‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å DB:", data);
      console.log("‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ):", error);
      console.log("‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á login:", user.email);

      if (userError || !user) {
        document.getElementById('employee').innerHTML = `<p>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</p>`;
        console.error("User error:", userError);
        return;
      }
      
      if (error) {
        console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô:", error);
        document.getElementById('employee').innerHTML = `<p>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</p>`;
        return;
      }

      if (data.length > 0) {
        const emp = data[0];
        document.getElementById('employee').innerHTML = `
          <h2>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h2>
          <p>‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: ${emp.employee_id}</p>
          <p>‡∏ä‡∏∑‡πà‡∏≠: ${emp.username}</p>
          <p>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${emp.role}</p>
        `;
      } else {
        document.getElementById('employee').innerHTML = `<p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</p>`;
      }
    }  


    async function logout() {
     const { error } = await supabase.auth.signOut();

      if (error) {
        console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö:", error);
      } else {
        console.log("‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
        // ‡∏•‡∏≠‡∏á‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å logout
        location.reload();
        window.location.href = "login.html"; // ‡πÑ‡∏õ‡∏ó‡∏µ‡πà login.html ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å reload
      }
    }
    
    window.addEventListener("DOMContentLoaded", async () => {
      const { data: { user }, error } = await supabase.auth.getUser();

      if (error || !user) {
        window.location.href = "login.html";
        return;
      }

      await loadEmployeeInfo();
      await checkAdminMenu();
    });

    document.addEventListener('DOMContentLoaded', function() {
    function updateDateTime() {
      const now = new Date();
      const options = {
        weekday: 'long', year: 'numeric', month: 'long',
        day: 'numeric', hour: '2-digit', minute: '2-digit',
        hour12: false
      };
      const datetimeStr = now.toLocaleString('th-TH', options);
      const datetimeEl = document.getElementById('datetime');
      if (datetimeEl) {
        datetimeEl.textContent = `üïí ${datetimeStr}`;
      }
    }

      updateDateTime();
      setInterval(updateDateTime, 60000);
    });



    function showSection(id) {
      document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
      document.querySelectorAll('.nav-link').forEach(link => {
        if (link.getAttribute('onclick')?.includes(id)) link.classList.add('active');
      });
    }


    async function checkAdminMenu() {
      const { data: { user } } = await supabase.auth.getUser();

      const { data: emp, error } = await supabase
        .from("employees")
        .select("special_role")
        .eq("email", user.email)
        .single();

      if (emp && emp.special_role === 'admin') {
        // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏ô‡∏π admin ‡∏ó‡∏±‡πâ‡∏á‡πÉ‡∏ô desktop ‡πÅ‡∏•‡∏∞ mobile
        ['admin-menu', 'admin-menu-mobile'].forEach(function(id) {
          const el = document.getElementById(id);
          if (el) el.style.display = 'block';
        });
      }
    }



    function startScan() {
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ qrScanner ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
      if (!qrScanner) {
        qrScanner = new Html5Qrcode("qr-reader"); // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Element ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÇ‡∏ä‡∏ß‡πå‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô
      }

      qrScanner.start(
        { facingMode: "environment" }, // ‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô
        {
          fps: 10, // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô (frame per second)
          qrbox: { width: 250, height: 250 } // ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡πÅ‡∏Å‡∏ô
        },
        async (decodedText, decodedResult) => {
          console.log("QR ‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏î‡πâ:", decodedText);
          // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö QR Code ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ
          if (decodedText === `qr-code-check-in-${new Date().toISOString().split('T')[0]}`) {
          await saveCheckin();
          await qrScanner.stop();
          document.getElementById("qr-result").textContent = "‚úÖ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢";
        } else {
          document.getElementById("qr-result").textContent = "‚ùå QR ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
        }
        },
        (errorMessage) => {
          console.warn("‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:", errorMessage); // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡πâ‡∏≤‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        }
      ).catch(err => {
        console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô:", err); // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô
      });
      
    }

    function stopScan() {
      if (qrScanner) {
        qrScanner.stop().then(() => {
          console.log("‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡πÅ‡∏•‡πâ‡∏ß");
          document.getElementById("qr-result").textContent = "‚ùå ‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡∏ñ‡∏π‡∏Å‡∏´‡∏¢‡∏∏‡∏î";
        }).catch((err) => {
          console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô:", err);
        });
      }
    }


    async function saveCheckin() {
    const { data: userData } = await supabase.auth.getUser();
    const email = userData?.user?.email;

    const { data: empData, error: empErr } = await supabase
      .from("employees")
      .select("employee_id")
      .eq("email", email)
      .single();

    if (empErr || !empData) {
      document.getElementById("qr-result").innerHTML = "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô";
      return;
    }

    // ‡πÉ‡∏ä‡πâ geolocation ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(async (position) => {
        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;

        const { error } = await supabase.from("attendence_log").insert([
          {
            check_type: "check-in",
            timestamp: new Date().toISOString(),
            employee_id: empData.employee_id,
            location: "office", // ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡πÉ‡∏™‡πà custom location string ‡∏Å‡πá‡πÑ‡∏î‡πâ
            latitude: latitude,
            longitude: longitude
          }
        ]);

        if (error) {
          document.getElementById("qr-result").textContent = "‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
        }
      }, () => {
        document.getElementById("qr-result").textContent = "‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ";
      });
    } else {
      document.getElementById("qr-result").textContent = "‚ùå ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á";
    }
  }

    async function saveCheckout() {
      const { data: userData } = await supabase.auth.getUser();
      const email = userData?.user?.email;

      const { data: empData, error: empErr } = await supabase
        .from("employees")
        .select("employee_id")
        .eq("email", email)
        .single();

      if (empErr || !empData) {
        document.getElementById("qr-result").innerHTML = "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô";
        return;
      }

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async (position) => {
          const latitude = position.coords.latitude;
          const longitude = position.coords.longitude;

          const { error } = await supabase.from("attendence_log").insert([
            {
              check_type: "check-out",
              timestamp: new Date().toISOString(),
              employee_id: empData.employee_id,
              location: "office",
              latitude: latitude,
              longitude: longitude
            }
          ]);

          if (error) {
            document.getElementById("qr-result").textContent = "‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
          }
        }, () => {
          document.getElementById("qr-result").textContent = "‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ";
        });
      } else {
        document.getElementById("qr-result").textContent = "‚ùå ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á";
      }
    }


    function startScanCheckout() {
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ qrScanner ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
      if (!qrScanner) {
        qrScanner = new Html5Qrcode("qr-reader-checkout"); // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Element ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÇ‡∏ä‡∏ß‡πå‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô
      }

      qrScanner.start(
        { facingMode: "environment" }, // ‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô
        {
          fps: 10, // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô (frame per second)
          qrbox: { width: 250, height: 250 } // ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡πÅ‡∏Å‡∏ô
        },
        async (decodedText, decodedResult) => {
          console.log("QR ‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏î‡πâ:", decodedText);
          // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö QR Code ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ
          if (decodedText === `qr-code-check-out-${new Date().toISOString().split('T')[0]}`) {
            await saveCheckout();
            await qrScanner.stop();
            document.getElementById("qr-result").textContent = "‚úÖ ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢";
          } else {
            document.getElementById("qr-result").textContent = "‚ùå QR ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
          }
        },
        (errorMessage) => {
          console.warn("‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:", errorMessage); // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡πâ‡∏≤‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        }
      ).catch(err => {
        console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô:", err); // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô
      });
    }

    function toggleQRCode(type) {
      const qrDiv = document.getElementById(`${type}-qr`);
      
      // ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡∏≠‡∏á QR Code
      if (qrDiv.style.display === 'none') {
        // ‡∏ñ‡πâ‡∏≤ QR Code ‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á
        generateQRCode(type);
        qrDiv.style.display = 'block';
      } else {
        // ‡∏ñ‡πâ‡∏≤ QR Code ‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô
        qrDiv.style.display = 'none';
      }
    }

    async function generateQRCode(type) {
  const today = new Date();
  const dateStr = today.toISOString().split('T')[0]; // YYYY-MM-DD
  
  let codeData;
  if (type === 'check-in') {
    codeData = `qr-code-check-in-${dateStr}`;
  } else if (type === 'check-out') {
    codeData = `qr-code-check-out-${dateStr}`;
  }

  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å QR ‡∏•‡∏á Supabase
  await saveQRCodeToDatabase(codeData, type, dateStr);

  const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${codeData}`;
  document.getElementById(`${type}-qr`).innerHTML = `
    <h5>QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ ${type === 'check-in' ? '‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô' : '‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô'}:</h5>
    <img src="${qrCodeUrl}" />`;
}

async function saveQRCodeToDatabase(codeData, type, dateStr) {
  const { data, error } = await supabase
    .from("daily_qr_codes")
    .upsert([
      {
        date: dateStr,
        qr_code_text: codeData,
        type: type,
      }
    ], { onConflict: ['date', 'type'] }); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô insert ‡∏ã‡πâ‡∏≥

  if (error) {
    console.error("‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å QR ‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", error.message);
  } else {
    console.log("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å QR ‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß");
  }
}



    function generateCheckInQRCode() {
      const today = new Date();
      const dateStr = today.toISOString().split('T')[0]; // ‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö YYYY-MM-DD
      const checkInCode = `qr-code-check-in-${dateStr}`; // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö QR Code ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô

      const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${checkInCode}`;
      document.getElementById("check-in-qr").innerHTML = `
      <h5>QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô:</h5>
      <img src="${qrCodeUrl}" />`;
    }

    function generateCheckOutQRCode() {
      const today = new Date();
      const dateStr = today.toISOString().split('T')[0]; // ‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö YYYY-MM-DD
      const checkOutCode = `qr-code-check-out-${dateStr}`; // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö QR Code ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå

      const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${checkOutCode}`;
      document.getElementById("check-out-qr").innerHTML = `
      <h5>QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏≤‡∏ô:</h5>
      <img src="${qrCodeUrl}" />`;
    }

    async function viewAttendanceLog() {
      const { data, error } = await supabase.from("attendence_log").select("*").order("timestamp", { ascending: false });

      const logDiv = document.getElementById("attendance-log");
      if (error) {
        logDiv.innerHTML = `<p class="text-danger">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>`;
        return;
      }

      let html = "<ul class='list-group'>";
      data.forEach(log => {
        html += `<li class='list-group-item'>
          üßæ ${log.employee_id} - ${log.check_type} @ ${new Date(log.timestamp).toLocaleString("th-TH")}
        </li>`;
      });
      html += "</ul>";
    logDiv.innerHTML = html;
  }    

  function openLeaveForm() {
    document.getElementById('leave-form').style.display = 'block';
  }

  async function submitLeaveRequest() {
    const type = document.getElementById('leave-type').value;
    const date = document.getElementById('leave-date').value;
    const user = await supabase.auth.getUser();
    const email = user.data.user.email;

    // ‡∏î‡∏∂‡∏á employee_id ‡∏à‡∏≤‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡∏™‡∏°‡∏°‡∏∏‡∏ï‡∏¥‡∏ß‡πà‡∏≤ login ‡∏î‡πâ‡∏ß‡∏¢‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡∏£‡∏á employee)
    const { data: employeeData, error: empError } = await supabase
      .from('employees')
      .select('employee_id')
      .eq('email', email)
      .single();

    if (empError || !employeeData) {
      alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô');
      return;
    }

    const employee_id = employeeData.employee_id;

    const { error } = await supabase.from('leave_days').insert([
      {
        employee_id: employee_id,
        type: type,
        date: date,
        status: 'pending' // ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
      }
    ]);

    if (error) {
      alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠');
      console.error(error);
    } else {
      alert('‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô');
      document.getElementById('leave-form').style.display = 'none';
    }
  }

  function openLeaveForm() {
    document.getElementById('leave-form').style.display = 'block';
  }


  function toggleTimeInputs() {
    const type = document.querySelector('input[name="time-type"]:checked').value;
    document.getElementById('hour-inputs').style.display = (type === 'hour') ? 'block' : 'none';
    document.getElementById('day-inputs').style.display = (type === 'day') ? 'block' : 'none';
  }


  window.onload = function () {
    document.getElementById("start-date").addEventListener("change", calcDayLeave);
    document.getElementById("end-date").addEventListener("change", calcDayLeave);

    document.getElementById("start-time").addEventListener("change", calcHourLeave);
    document.getElementById("end-time").addEventListener("change", calcHourLeave);
  }

  function calcHourLeave() {
  const date = document.getElementById("hour-date").value;
  const startTime = document.getElementById("start-time").value;
  const endTime = document.getElementById("end-time").value;
  const output = document.getElementById("hour-duration");

  if (date && startTime && endTime) {
    const startDateTime = new Date(`${date}T${startTime}`);
    const endDateTime = new Date(`${date}T${endTime}`);

    if (endDateTime > startDateTime) {
      const diffMs = endDateTime - startDateTime;
      const hours = diffMs / (1000 * 60 * 60);
      output.innerText = `‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${hours.toFixed(2)} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á`;
    } else {
      output.innerText = "‚ö†Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô";
    }
  } else {
    output.innerText = ""; // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏£‡∏ö
  }
}



  function calcDayLeave() {
    const start = document.getElementById("start-date").value;
    const end = document.getElementById("end-date").value;
    const output = document.getElementById("day-duration");

    if (start && end) {
      const startDate = new Date(start);
      const endDate = new Date(end);

      if (endDate >= startDate) {
        const diffDays = (endDate - startDate) / (1000 * 60 * 60 * 24) + 1;
        output.innerText = `‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${diffDays} ‡∏ß‡∏±‡∏ô`;
      } else {
        output.innerText = "‚ö†Ô∏è ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô";
      }
    } else {
      output.innerText = ""; // Clear text if one of the dates is missing
    }
  }


  function confirmSubmit() {
  const leaveType = document.getElementById('leave-type').value;
  const timeType = document.querySelector('input[name="time-type"]:checked').value;
  const remarks = document.getElementById('leave-remarks').value;

  let startDate, endDate, startTime, endTime;

  if (timeType === 'day') {
    startDate = document.getElementById('start-date').value;
    endDate = document.getElementById('end-date').value;
  } else if (timeType === 'hour') {
    startDate = document.getElementById('hour-date').value;
    startTime = document.getElementById('start-time').value;
    endTime = document.getElementById('end-time').value;
  }

  const data = {
    leaveType,
    timeType,
    startDate,
    endDate,
    startTime,
    endTime,
    remarks
  };

  // ‡πÉ‡∏ä‡πâ fetch ‡∏´‡∏£‡∏∑‡∏≠ axios ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏ó‡∏µ‡πà API ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
  fetch('/api/submit_leave_days', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(data)
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      alert('‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      // ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
    } else {
      alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠');
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
  });
}


function previewLeave() {
  if (!validateLeaveForm()) return;

  const timeType = document.querySelector('input[name="time-type"]:checked').value;
  const leaveType = document.getElementById('leave-type').value;
  const remarks = document.getElementById('leave-remarks').value.trim();
  const summary = [];

  summary.push(`‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤: ${mapLeaveType(leaveType)}`);
  summary.push(`‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏ß‡∏•‡∏≤: ${timeType === "day" ? "‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô" : "‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á"}`);

  if (timeType === "day") {
    const startDate = document.getElementById("start-date").value;
    const endDate = document.getElementById("end-date").value;

    if (new Date(startDate) > new Date(endDate)) {
      alert("‚ö†Ô∏è ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î");
      return;
    }

    summary.push(`‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ${startDate}`);
    summary.push(`‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î: ${endDate}`);
    const diffDays = (new Date(endDate) - new Date(startDate)) / (1000 * 60 * 60 * 24) + 1;
    summary.push(`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${diffDays} ‡∏ß‡∏±‡∏ô`);

  } else {
    const date = document.getElementById("hour-date").value;
    const startTime = document.getElementById("start-time").value;
    const endTime = document.getElementById("end-time").value;

    if (!date || !startTime || !endTime) {
      alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
      return;
    }

    const start = new Date(`${date}T${startTime}`);
    const end = new Date(`${date}T${endTime}`);

    if (end <= start) {
      alert("‚ö†Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô");
      return;
    }

    const diffHours = (end - start) / (1000 * 60 * 60);

    summary.push(`‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${date}`);
    summary.push(`‡πÄ‡∏ß‡∏•‡∏≤: ${startTime} - ${endTime}`);
    summary.push(`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${diffHours.toFixed(2)} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á`);
  }

  if (remarks) {
    summary.push(`‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°: ${remarks}`);
  }



  document.getElementById("leave-form").style.display = "none"; // ‡∏ã‡πà‡∏≠‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
  document.getElementById("leave-summary").style.display = "block";
  document.getElementById("summary-content").innerHTML = summary.join("<br>");
}


// helper ‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏•‡∏≤
function mapLeaveType(value) {
  switch (value) {
    case "sick": return "‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢";
    case "personal": return "‡∏•‡∏≤‡∏Å‡∏¥‡∏à";
    case "vacation": return "‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô";
    case "other": return "‡∏≠‡∏∑‡πà‡∏ô‡πÜ";
    default: return "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö";
  }
}


function validateLeaveForm() {
    const leaveType = document.getElementById("leave-type").value;
    const timeType = document.querySelector('input[name="time-type"]:checked').value;
    

    if (timeType === "day") {
      const startDate = document.getElementById("start-date").value;
      const endDate = document.getElementById("end-date").value;
      if (!startDate || !endDate) {
        alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î");
        return false;
      }
    } else {
      const date = document.getElementById("hour-date").value;
      const startTime = document.getElementById("start-time").value;
      const endTime = document.getElementById("end-time").value;
      if (!date || !startTime || !endTime) {
        alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
        return false;
      }
    }
    return true;
  }

function cancelPreview() {
  document.getElementById("leave-form").style.display = "block"; // ‡πÅ‡∏™‡∏î‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
  document.getElementById("leave-summary").style.display = "none"; // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡∏£‡∏∏‡∏õ
}


  async function confirmSubmit() {
    const leaveType = document.getElementById('leave-type').value;
    const timeType = document.querySelector('input[name="time-type"]:checked').value;
    const remarks = document.getElementById('leave-remarks').value;
    

    let startDate = null;
    let endDate = null;
    let startTime = null;
    let endTime = null;

    if (timeType === 'day') {
      startDate = document.getElementById('start-date').value;
      endDate = document.getElementById('end-date').value;
    } else {
      startDate = document.getElementById('hour-date').value;
      startTime = document.getElementById('start-time').value;
      endTime = document.getElementById('end-time').value;
    }

    // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏≥‡∏•‡∏≠‡∏á employee_id
    const employeeId = 1;

    const { error } = await supabase.from('leave_days').insert({
      employee_id: employeeId,
      leave_type: leaveType,
      time_type: timeType,
      start_date: startDate || null,
      end_date: endDate || null,
      start_time: startTime || null,
      end_time: endTime || null,
      leave_remarks: remarks,
      status: 'pending' // ‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô
    });

    if (error) {
      alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠: ' + error.message);
    } else {
      alert('‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
      location.reload();
    }
  }

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î Navbar ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏•‡∏¥‡∏á‡∏Ñ‡πå
function closeNavbar() {
  const navbarCollapse = document.getElementById('mobileNavbar');
  const navbarToggler = document.querySelector('.navbar-toggler');

  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  if (navbarCollapse.classList.contains('show')) {
    // ‡∏´‡∏≤‡∏Å‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î
    const bsCollapse = new bootstrap.Collapse(navbarCollapse, {
      toggle: false
    });
    bsCollapse.hide();
  }
}



  </script>
  

</head>
<body>
<div >
  <div>
    <nav class="navbar navbar-expand-lg navbar-light bg-success d-lg-none w-100">
      <div class="container-fluid">
        <a class="navbar-brand text-white" href="#">‡πÄ‡∏°‡∏ô‡∏π</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mobileNavbar" aria-controls="mobileNavbar" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="mobileNavbar">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link text-white" href="#" onclick="showSection('home'); closeNavbar()">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a></li>
            <li class="nav-item"><a class="nav-link text-white" href="#" onclick="showSection('checkin'); closeNavbar()">üü¢ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤</a></li>
            <li class="nav-item"><a class="nav-link text-white" href="#" onclick="showSection('checkout'); closeNavbar()">üî¥ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡∏Å</a></li>
            <li class="nav-item"><a class="nav-link text-white" href="#" onclick="showSection('calendar-page'); closeNavbar()">üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</a></li>
            <li class="nav-item"><a class="nav-link text-white" href="#" onclick="showSection('notifications'); closeNavbar()">üîî ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</a></li>
            <li class="nav-item"><a class="nav-link text-white" href="#" onclick="showSection('payroll'); closeNavbar()">üí∏ ‡∏™‡∏•‡∏¥‡∏õ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</a></li>
            <p class="text-white me-auto mb-2 mb-lg-0">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
            <li class="nav-item"><a class="nav-link text-white" href="#" onclick="showSection('leave-form'); closeNavbar()">üìÑ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏≤</a></li>
            <li id="admin-menu-mobile" class="nav-item" style="display:none;">
              <p class="text-white me-auto mb-2 mb-lg-0">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</p>
              <li class="nav-item"><a class="nav-link text-white" href="#" onclick="showSection('admin')">üõ†Ô∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö</a></li>
          <li class="nav-item"><a class="nav-link text-white" href="#" onclick="showSection('request')">‚è≥ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</a></li>
            </li>
          </ul>
          <button class="btn btn-light mt-2" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
      </div>
    </nav>
    
  
    <!-- üîπ Sidebar ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Desktop (‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏≠‡∏ô‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å) -->
    <div id="sidebar" class="bg-success text-white p-3 d-none d-lg-block" style="min-width: 250px; height: 100vh; position: fixed; top: 0; left: 0;">
      <h4 class="mb-4">‡πÄ‡∏°‡∏ô‡∏π</h4>
      <ul class="nav flex-column">
        <li class="nav-item"><a class="nav-link text-white" href="#" onclick="showSection('home')">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a></li>
        <li class="nav-item"><a class="nav-link text-white" href="#" onclick="showSection('checkin')">üü¢ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤</a></li>
        <li class="nav-item"><a class="nav-link text-white" href="#" onclick="showSection('checkout')">üî¥ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡∏Å</a></li>
        <li class="nav-item"><a class="nav-link text-white" href="#" onclick="showSection('calendar-page')">üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</a></li>
        <li class="nav-item"><a class="nav-link text-white" href="#" onclick="showSection('notifications')">üîî ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</a></li>
        <li class="nav-item"><a class="nav-link text-white" href="#" onclick="showSection('payroll')">üí∏ ‡∏™‡∏•‡∏¥‡∏õ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</a></li>
        <p class="text-white me-auto mb-2 mb-lg-0">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
        <li class="nav-item"><a class="nav-link text-white" href="#" onclick="showSection('leave-form')">üìÑ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏≤</a></li>
        <li id="admin-menu" class="nav-item" style="display:none;">
          <p class="text-white me-auto mb-2 mb-lg-0">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</p>
          <li class="nav-item"><a class="nav-link text-white" href="#" onclick="showSection('admin')">üõ†Ô∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö</a></li>
          <li class="nav-item"><a class="nav-link text-white" href="#" onclick="showSection('request')">‚è≥ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</a></li>
        </li>
      </ul>
      <button class="btn btn-light mt-4" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
  </div>
  

  <!-- üîπ Main Content -->
  <div class="main-content">
    <div class="container py-4" id="main-content">
      <div id="home" class="section active">
        <h2>üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</h2>
        <div id="employee">
          <h2>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô...</h2>
        </div>
        <div id="datetime" class="mb-3 text-muted"></div>
        <div class="mb-3 d-flex flex-column justify-content-center align-items-center gap-2">
          <button class="btn btn-success w-50" onclick="showSection('checkin')">üü¢ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤</button>
          <button class="btn btn-danger w-50" onclick="showSection('checkout')">üî¥ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡∏Å</button>
        </div>        
        <div class="mb-4">
          <h5>üîó ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h5>
          <div class="d-grid gap-2">
            <button class="btn btn-outline-primary" onclick="showSection('calendar-page')">üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>
            <button class="btn btn-outline-warning" onclick="showSection('notifications')">üîî ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</button>
            <button class="btn btn-outline-info" onclick="showSection('payroll')">üí∏ ‡∏™‡∏•‡∏¥‡∏õ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
          </div>
        </div>
      </div>
      
      <div id="checkin" class="section">
        <h2>üü¢ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤</h2>
        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤</p>
        <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô -->
        <button class="btn btn-success mt-3" onclick="startScan()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏™‡∏Å‡∏ô</button>
        <button class="btn btn-danger mt-3" onclick="stopScan()">‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏™‡∏Å‡∏ô</button>
        <div id="qr-reader" style="width:300px;height:300px;"></div>
        <div id="qr-result" class="mt-3 text-center text-success fw-bold"></div>
      </div>

      <div id="checkout" class="section">
        <h2>üî¥ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å</h2>
        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å</p>
        <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô -->
        <button class="btn btn-success mt-3" onclick="startScanCheckout()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏™‡∏Å‡∏ô</button>
        <button class="btn btn-danger mt-3" onclick="stopScan()">‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏™‡∏Å‡∏ô</button>
        <div id="qr-reader-checkout" style="width:300px;height:300px;"></div>
        <div id="qr-result" class="mt-3 text-center text-success fw-bold"></div>
      </div>

      <div id="calendar-page" class="section">
        <h2>üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h2>
        <div id="calendar"></div>
        <div id="calendar-details" class="mt-3 p-2 border rounded bg-light"></div>

        <script>
          function markMondaysAsHoliday(dayTypes, startDate, endDate) {
            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
              if (d.getDay() === 2) { // ‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå (0=‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå, 1=‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå,...)
                const dateStr = d.toISOString().split('T')[0];
                if (!dayTypes[dateStr]) dayTypes[dateStr] = [];
                if (!dayTypes[dateStr].includes('holiday')) {
                  dayTypes[dateStr].push('holiday');
                }
              }
            }
          }

          document.addEventListener('DOMContentLoaded', async function () {
            const calendarEl = document.getElementById('calendar');
      
            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Supabase
            const [leaveRes, holidayRes, attendanceRes] = await Promise.all([
              supabase.from('leave_days').select('start_date, end_date, start_time, end_time, leave_type'),
              supabase.from('holidays').select('date, title'),
              supabase.from('attendance_log').select('timestamp, check_type')
            ]);
      
            if (leaveRes.error || holidayRes.error || attendanceRes.error) {
              console.error('Error loading data', leaveRes.error, holidayRes.error, attendanceRes.error);
              return;
            }
            
            console.log('Leave Days:', leaveRes.data, leaveRes.error);
            console.log('Holidays:', holidayRes.data, holidayRes.error);
            console.log('Attendance:', attendanceRes.data, attendanceRes.error);
        
            const dayTypes = {};
      
            // ‡∏ß‡∏±‡∏ô‡∏•‡∏≤
            leaveRes.data.forEach(item => {
              const start = item.start_date;
              const end = item.end_date || start; // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ end_date ‡πÉ‡∏ä‡πâ start_date ‡πÅ‡∏ó‡∏ô

              const current = new Date(start + 'T00:00:00');
              const endDate = new Date(end + 'T00:00:00');


              while (current <= endDate) {
                const dateStr = current.toISOString().split('T')[0];
                if (!dayTypes[dateStr]) dayTypes[dateStr] = [];
                dayTypes[dateStr].push('leave');
                current.setDate(current.getDate() + 1);
              }
            });

      
            // ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î
            holidayRes.data.forEach(item => {
              const date = item.date; // '2025-04-30'
              if (!dayTypes[date]) dayTypes[date] = [];
              dayTypes[date].push('holiday');
              console.log(typeof item.date, item.date);

            });

            // ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å check-in ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            attendanceRes.data.forEach(item => {
              if (item.check_type === 'in') {
                const date = new Date(item.timestamp).toISOString().split('T')[0];
                if (!dayTypes[date]) dayTypes[date] = [];
                if (!dayTypes[date].includes('workday')) {
                  dayTypes[date].push('workday');
                }
              }
            });

            // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô
            const calendar = new FullCalendar.Calendar(calendarEl, {
              initialView: 'dayGridMonth',
              locale: 'th',
              height: 'auto',
              showNonCurrentDates: false,

              dayCellContent: function (arg) {
                const year = arg.date.getFullYear();
                const month = (arg.date.getMonth() + 1).toString().padStart(2, '0');
                const day = arg.date.getDate().toString().padStart(2, '0');
                const dateStr = `${year}-${month}-${day}`;
                
                let dots = '';
                if (dayTypes[dateStr]) {
                  dots += `<div class="dots-container">`;
                  dayTypes[dateStr].forEach(type => {
                    dots += `<span class="dot ${type}"></span>`;
                  });
                  dots += `</div>`;
                }

                return { html: `<div>${arg.date.getDate()}${dots}</div>` };
              },

              dateClick: function (info) {
                const clickedDate = info.dateStr;
                const types = dayTypes[clickedDate] || [];

                const descriptionMap = {
                  leave: '‡∏ß‡∏±‡∏ô‡∏•‡∏≤',
                  holiday: '‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î',
                  workday: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô',
                  mondayHoliday: '‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó'
                };

                const readable = types.length > 0
                  ? types.map(type => descriptionMap[type] || type).join(', ')
                  : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';

                const detailsEl = document.getElementById('calendar-details');
                  detailsEl.innerHTML = `
                  <h5>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${clickedDate}</h5>
                  <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ${readable}</p>
                `;
                },

              // ‚úÖ ‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏•‡∏∑‡∏°‡πÉ‡∏™‡πà‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Calendar config
                datesSet: function(info) {
                const calendar = info.view.calendar;

                // ‡∏•‡∏ö 'holiday' ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô holidayRes)
                Object.keys(dayTypes).forEach(date => {
                  const types = dayTypes[date];
                  const d = new Date(date);
                  if (d.getDay() === 1) { // ‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå
                    const index = types.indexOf('holiday');
                    if (index !== -1) {
                      types.splice(index, 1);
                      if (types.length === 0) delete dayTypes[date];
                    }
                  }
                });

                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡πÉ‡∏´‡∏°‡πà
                markMondaysAsHoliday(dayTypes, info.start, new Date(info.end.getTime() - 1));
                calendar.render();
              }
            });

            calendar.render();
          });
      
        </script>
        
      </div>

      <div id="leave-form" class="section">
        <h2>üìÑ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏≤</h2>
      
        <label>‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label><br>
        <select id="leave-type">
          <option value="sick">‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</option>
          <option value="personal">‡∏•‡∏≤‡∏Å‡∏¥‡∏à</option>
          <option value="vacation">‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô</option>
          <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
        </select>
        <br>
      
        <label>‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡∏•‡∏≤</label><br>
        <input type="radio" name="time-type" value="day" checked onchange="toggleTimeInputs()"> ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô
        <input type="radio" name="time-type" value="hour" onchange="toggleTimeInputs()"> ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
        <br>
      
        <div id="hour-inputs" style="display: none;">
          <label>‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label><br>
          <label>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><br>
          <input type="date" id="hour-date"><br>
          ‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° <input type="time" id="start-time"><br> 
          ‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î <input type="time" id="end-time">
          <br>
        </div>
      
        <div id="day-inputs">
          <label>‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label><br>
          <label>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label><br>
          <input type="date" id="start-date"><br>
          <label>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label><br>
          <input type="date" id="end-date"><br><br>
          
        </div>

        <label>üìù ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label><br>
        <textarea id="leave-remarks" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏≤..." rows="4"></textarea>
        <br>
      
        <p id="hour-duration" style="color: green;"></p>
        <p id="day-duration" style="color: green;"></p>

        <button onclick="previewLeave()">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠</button>
      </div>
    
      <div id="leave-summary" style="display:none; border: 1px solid gray; padding: 20px; margin-top: 20px;">
          <h3>üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏•‡∏≤</h3>
          <div id="summary-content"></div>
          <br>
          <button onclick="confirmSubmit()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠</button>
          <button onclick="cancelPreview()">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
      </div>
      
    
      <div id="notifications" class="section"><h2>üîî ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h2></div>
      <div id="payroll" class="section"><h2>üí∏ ‡∏™‡∏•‡∏¥‡∏õ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h2></div>

      <div id="admin" class="section">
        <h2>üõ†Ô∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö</h2>
        <p>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</p>
        <div class="mb-4">
          <h4>üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h4>
          <button class="btn btn-outline-primary mb-2" onclick="toggleAddForm()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</button>
          <button class="btn btn-outline-warning">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
          <button class="btn btn-outline-danger">üóëÔ∏è ‡∏•‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</button>
          
          <form id="add-employee-form" class="row g-2 mb-3" style="display: none;">
            <div class="col-md-4">
              <input type="text" class="form-control" id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á" required>
            </div>
            <div class="col-md-4">
              <input type="email" class="form-control" id="username" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô" required>
            </div>
       
            <div class="col-md-4">
              <input type="email" class="form-control" id="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" required>
            </div>
            <div class="col-md-4">
              <input type="email" class="form-control" id="tel" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£" required>
            </div>
            <div class="col-md-4">
              <select id="role" class="form-select" required>
                <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</option>
                <option value="Full-time">Full-time</option>
                <option value="Part-time">Part-time</option>
                <option value="Internship">Internship</option>
              </select>
            </div>
            
            <div class="col-md-4">
              <select id="bank" class="form-select" required>
                <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</option>
                <option value="‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û">‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û</option>
                <option value="‡πÑ‡∏ó‡∏¢‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå">‡πÑ‡∏ó‡∏¢‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå</option>
                <option value="‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢">‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢</option>
                <option value="‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢">‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢</option>
                <option value="‡∏Å‡∏£‡∏∏‡∏á‡∏®‡∏£‡∏µ">‡∏Å‡∏£‡∏∏‡∏á‡∏®‡∏£‡∏µ</option>
                <option value="‡∏≠‡∏≠‡∏°‡∏™‡∏¥‡∏ô">‡∏≠‡∏≠‡∏°‡∏™‡∏¥‡∏ô</option>
                <option value="‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå</option>
                <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
              </select>
            </div>

            <div class="col-md-4" id="other-bank-container" style="display: none;">
              <input type="text" class="form-control" id="other-bank" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£">
            </div>

            <div class="col-md-4">
              <input type="email" class="form-control" id="bank_number" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ" required>
            </div>
         
            <div class="col-md-4">
              <button type="submit" class="btn btn-success">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
          </form>

          <ul id="employee-list" class="list-group"></ul>




        </div>

        <script>
          // ‚úÖ ‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
          function toggleAddForm() {
            const form = document.getElementById('add-employee-form');
            form.style.display = form.style.display === 'none' ? 'flex' : 'none';
          }
          
          function toggleOtherBank(selectElement) {
            const otherBankContainer = document.getElementById('other-bank-container');
            const otherBankInput = document.getElementById('other-bank');
            
            if (selectElement.value === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') {
              otherBankContainer.style.display = 'block';
              otherBankInput.required = true;
            } else {
              otherBankContainer.style.display = 'none';
              otherBankInput.required = false;
            }
          }

          
        </script>
        

        <div class="mb-4">
          <h4>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô/‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå</h4>
          <button class="btn btn-outline-secondary" onclick="viewAttendanceLog()">üìÖ ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
          <div id="attendance-log"></div>
        </div>

        <div class="mb-4">
          <h4>üì¶ QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h4>
          <button class="btn btn-outline-success" onclick="toggleQRCode('check-in')">üîÑ ‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
          </button>
          <button class="btn btn-outline-danger" onclick="toggleQRCode('check-out')">üîÑ ‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô</button>
          <div id="today-qr" class="mt-4">
            <div id="check-in-qr" style="display: none;"></div>
            <div id="check-out-qr" style="display: none;"></div>
          </div>
        </div>
      </div>

      <div id="request" class="section">
        <h2>‚è≥ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h2>
      </div>

    </div>
  </div>
</div>    
</body>
</html>
